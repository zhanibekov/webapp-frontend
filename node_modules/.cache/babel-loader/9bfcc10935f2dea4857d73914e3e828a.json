{"ast":null,"code":"import _regeneratorRuntime from\"/Users/elamanzanibekov/Documents/GitHub/webapp-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/elamanzanibekov/Documents/GitHub/webapp-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/elamanzanibekov/Documents/GitHub/webapp-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React from'react';import TextField from'@mui/material/TextField';import Paper from'@mui/material/Paper';import Button from'@mui/material/Button';import SimpleMDE from'react-simplemde-editor';import{selectIsAuth}from\"../../redux/slices/Auth\";import{useSelector}from'react-redux';import axios from'../../axios';import'easymde/dist/easymde.min.css';import styles from'./AddPost.module.scss';import{Navigate,useNavigate,useParams}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var AddPost=function AddPost(){var _useParams=useParams(),id=_useParams.id;var navigate=useNavigate();var isAuth=useSelector(selectIsAuth);var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isLoading=_React$useState2[0],setLoading=_React$useState2[1];var _React$useState3=React.useState(''),_React$useState4=_slicedToArray(_React$useState3,2),text=_React$useState4[0],setText=_React$useState4[1];var _React$useState5=React.useState(''),_React$useState6=_slicedToArray(_React$useState5,2),title=_React$useState6[0],setTitle=_React$useState6[1];var _React$useState7=React.useState(''),_React$useState8=_slicedToArray(_React$useState7,2),tags=_React$useState8[0],setTags=_React$useState8[1];var _React$useState9=React.useState(''),_React$useState10=_slicedToArray(_React$useState9,2),imageUrl=_React$useState10[0],setImageUrl=_React$useState10[1];var inputFileRef=React.useRef(null);var isEditing=Boolean(id);var handleChangeFile=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(event){var formData,file,_yield$axios$post,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:console.log(event.target.files);_context.prev=1;formData=new FormData();file=event.target.files[0];formData.append('image',file);_context.next=7;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/upload\"),formData);case 7:_yield$axios$post=_context.sent;data=_yield$axios$post.data;console.log(data);setImageUrl(data.url);_context.next=17;break;case 13:_context.prev=13;_context.t0=_context[\"catch\"](1);console.warn(_context.t0);alert('Ошибка при загрузке файла!');case 17:case\"end\":return _context.stop();}}},_callee,null,[[1,13]]);}));return function handleChangeFile(_x){return _ref.apply(this,arguments);};}();var onClickRemoveImage=function onClickRemoveImage(){setImageUrl();};var onChange=React.useCallback(function(value){setText(value);},[]);var onSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){var fields,_ref3,data,_id;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;setLoading(true);fields={title:title,imageUrl:imageUrl,tags:tags.split(','),text:text};if(!isEditing){_context2.next=9;break;}_context2.next=6;return axios.patch(\"\".concat(process.env.REACT_APP_API_URL,\"/posts/\").concat(id),fields);case 6:_context2.t0=_context2.sent;_context2.next=12;break;case 9:_context2.next=11;return axios.post(\"\".concat(process.env.REACT_APP_API_URL,\"/posts\"),fields);case 11:_context2.t0=_context2.sent;case 12:_ref3=_context2.t0;data=_ref3.data;_id=isEditing?id:data._id;navigate(\"/posts/\".concat(_id));_context2.next=22;break;case 18:_context2.prev=18;_context2.t1=_context2[\"catch\"](0);console.warn(_context2.t1);alert('Ошибка при создании статьи');case 22:case\"end\":return _context2.stop();}}},_callee2,null,[[0,18]]);}));return function onSubmit(){return _ref2.apply(this,arguments);};}();React.useEffect(function(){if(id){axios.get(\"\".concat(process.env.REACT_APP_API_URL,\"/posts/\").concat(id)).then(function(_ref4){var data=_ref4.data;setTitle(data.title);setText(data.text);setImageUrl(data.imageUrl);setTags(data.tags.join(','));}).catch(function(error){console.warn(error);alert('Ошибка при получении статьи');});}},[]);var options=React.useMemo(function(){return{spellChecker:false,maxHeight:'400px',autofocus:true,placeholder:'Введите текст...',status:false,autosave:{enabled:true,delay:1000}};},[]);if(!window.localStorage.getItem('token')&&!isAuth){return/*#__PURE__*/_jsx(Navigate,{to:\"/\"});}console.log({title:title,tags:tags,text:text});return/*#__PURE__*/_jsxs(Paper,{style:{padding:30},children:[/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return inputFileRef.current.click();},variant:\"outlined\",size:\"large\",children:\"\\u0417\\u0430\\u0433\\u0440\\u0443\\u0437\\u0438\\u0442\\u044C \\u043F\\u0440\\u0435\\u0432\\u044C\\u044E\"}),/*#__PURE__*/_jsx(\"input\",{ref:inputFileRef,type:\"file\",onChange:handleChangeFile,hidden:true}),imageUrl&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"error\",onClick:onClickRemoveImage,children:\"\\u0423\\u0434\\u0430\\u043B\\u0438\\u0442\\u044C\"}),/*#__PURE__*/_jsx(\"img\",{className:styles.image,src:\"\".concat(process.env.REACT_APP_API_URL).concat(imageUrl),alt:\"Uploaded\"})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(TextField,{classes:{root:styles.title},variant:\"standard\",placeholder:\"\\u0417\\u0430\\u0433\\u043E\\u043B\\u043E\\u0432\\u043E\\u043A \\u0441\\u0442\\u0430\\u0442\\u044C\\u0438...\",value:title,onChange:function onChange(e){return setTitle(e.target.value);},fullWidth:true}),/*#__PURE__*/_jsx(TextField,{value:tags,onChange:function onChange(e){return setTags(e.target.value);},classes:{root:styles.tags},variant:\"standard\",placeholder:\"\\u0422\\u044D\\u0433\\u0438\",fullWidth:true}),/*#__PURE__*/_jsx(SimpleMDE,{className:styles.editor,value:text,onChange:onChange,options:options}),/*#__PURE__*/_jsxs(\"div\",{className:styles.buttons,children:[/*#__PURE__*/_jsx(Button,{onClick:onSubmit,size:\"large\",variant:\"contained\",children:isEditing?'Сохранить':'Опубликовать'}),/*#__PURE__*/_jsx(\"a\",{href:\"/\",children:/*#__PURE__*/_jsx(Button,{size:\"large\",children:\"\\u041E\\u0442\\u043C\\u0435\\u043D\\u0430\"})})]})]});};","map":{"version":3,"names":["React","TextField","Paper","Button","SimpleMDE","selectIsAuth","useSelector","axios","styles","Navigate","useNavigate","useParams","AddPost","id","navigate","isAuth","useState","isLoading","setLoading","text","setText","title","setTitle","tags","setTags","imageUrl","setImageUrl","inputFileRef","useRef","isEditing","Boolean","handleChangeFile","event","console","log","target","files","formData","FormData","file","append","post","process","env","REACT_APP_API_URL","data","url","warn","alert","onClickRemoveImage","onChange","useCallback","value","onSubmit","fields","split","patch","_id","useEffect","get","then","join","catch","error","options","useMemo","spellChecker","maxHeight","autofocus","placeholder","status","autosave","enabled","delay","window","localStorage","getItem","padding","current","click","image","root","e","editor","buttons"],"sources":["/Users/elamanzanibekov/Documents/GitHub/webapp-frontend/src/pages/AddPost/index.jsx"],"sourcesContent":["import React from 'react';\nimport TextField from '@mui/material/TextField';\nimport Paper from '@mui/material/Paper';\nimport Button from '@mui/material/Button';\nimport SimpleMDE from 'react-simplemde-editor';\nimport { selectIsAuth } from \"../../redux/slices/Auth\";\nimport { useSelector } from 'react-redux';\n\nimport axios from '../../axios';\nimport 'easymde/dist/easymde.min.css';\nimport styles from './AddPost.module.scss';\nimport { Navigate, useNavigate, useParams } from 'react-router-dom';\nexport const AddPost = () => {\n  const {id} = useParams()\n  const navigate = useNavigate();\n  const isAuth = useSelector(selectIsAuth);\n  const [isLoading, setLoading] = React.useState(false);\n  const [text, setText] = React.useState('');\n  const [title, setTitle] = React.useState('');\n  const [tags, setTags] = React.useState('');\n  const [imageUrl, setImageUrl] = React.useState('');\n\n  const inputFileRef = React.useRef(null)\n  const isEditing = Boolean(id)\n\n  const handleChangeFile = async(event) => {\n    console.log(event.target.files);\n    try {\n      const formData = new FormData();\n        const file = event.target.files[0];\n        formData.append('image', file)\n        const { data } = await axios.post(`${process.env.REACT_APP_API_URL}/upload`, formData);\n        console.log(data);\n        setImageUrl(data.url)\n      }catch(error) {\n        console.warn(error);\n        alert('Ошибка при загрузке файла!')\n    }\n  };\n\n  const onClickRemoveImage = () => {\n    setImageUrl();\n  };\n\n  const onChange = React.useCallback((value) => {\n    setText(value);\n  }, []);\n\n  const onSubmit = async() => {\n    try {\n      setLoading(true);\n      const fields = {\n        title,\n        imageUrl,\n        tags: tags.split(','),\n        text, \n      };\n      const { data } = isEditing\n      ? await axios.patch(`${process.env.REACT_APP_API_URL}/posts/${id}`, fields)\n      : await axios.post(`${process.env.REACT_APP_API_URL}/posts`, fields);\n      const _id = isEditing ? id  : data._id;\n      navigate(`/posts/${_id}`)\n    } catch(err) {\n      console.warn(err);\n      alert('Ошибка при создании статьи')\n    }\n    };\n    \n    React.useEffect(() => {\n      if(id) {\n         axios.get(`${process.env.REACT_APP_API_URL}/posts/${id}`).then(({data}) => {\n          setTitle(data.title);\n          setText(data.text);\n          setImageUrl(data.imageUrl);\n          setTags(data.tags.join(','))\n        }).catch(error => {\n          console.warn(error);\n          alert('Ошибка при получении статьи');\n        })\n        }\n    },[])\n\n  const options = React.useMemo(\n    () => ({\n      spellChecker: false,\n      maxHeight: '400px',\n      autofocus: true,\n      placeholder: 'Введите текст...',\n      status: false,\n      autosave: {\n        enabled: true,\n        delay: 1000,\n      },\n    }),\n    [],\n  );\n  if (!window.localStorage.getItem('token') && !isAuth) {\n    return(\n      <Navigate to='/' />\n    ) \n  }\n  console.log({title, tags, text});\n\n  return (\n    <Paper style={{ padding: 30 }}>\n      <Button onClick={() => inputFileRef.current.click()} variant=\"outlined\" size=\"large\">\n        Загрузить превью\n      </Button>\n      <input  ref={inputFileRef} type=\"file\" onChange={handleChangeFile} hidden />\n      {imageUrl && (\n        <>\n        <Button variant=\"contained\" color=\"error\" onClick={onClickRemoveImage}>\n          Удалить\n        </Button>\n         <img className={styles.image}  src={`${process.env.REACT_APP_API_URL}${imageUrl}`} alt=\"Uploaded\" />\n        </>\n      )}\n      <br />\n      <br />\n      <TextField\n        classes={{ root: styles.title }}\n        variant=\"standard\"\n        placeholder=\"Заголовок статьи...\"\n        value={title}\n        onChange={(e) => setTitle(e.target.value)}\n        fullWidth\n      />\n\n      <TextField \n      value={tags}\n      onChange={(e) => setTags(e.target.value)}\n      classes={{ root: styles.tags }} variant=\"standard\" placeholder=\"Тэги\" fullWidth />\n      <SimpleMDE className={styles.editor} value={text} onChange={onChange} options={options} />\n      <div className={styles.buttons}>\n        <Button onClick={onSubmit} size=\"large\" variant=\"contained\">\n          { isEditing ? 'Сохранить' :  'Опубликовать' }\n        </Button>\n        <a href=\"/\">\n          <Button size=\"large\">Отмена</Button>\n        </a>\n      </div>\n    </Paper>\n  );\n      }"],"mappings":"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"},"metadata":{},"sourceType":"module"}